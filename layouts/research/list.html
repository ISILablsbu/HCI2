{{/* Custom research section list with Hugo image processing and srcset */}}
{{ define "main" }}
<section id="section-research" class="container universal-wrapper">

  {{/* Page heading / banner (show title if present) */}}
  <div class="row">
    <div class="col-12 section-heading">
      <h1>{{ .Title }}</h1>
      {{ with .Params.banner.caption }}
        <p class="section-subtitle">{{ . }}</p>
      {{ end }}
    </div>
  </div>

  <div class="row">
    {{ range .Pages.ByDate.Reverse }}
      <article class="media stream-item view-compact">

        {{ $img := .Resources.GetMatch "featured*" }}
        {{ if $img }}
          {{/* Generate responsive images */}}
          {{ $small := $img.Fill "640x360 q75" }}
          {{ $medium := $img.Fill "1024x576 q80" }}
          {{ $large := $img.Fill "1600x900 q85" }}

          <div class="ml-3">
            <a href="{{ .RelPermalink }}">
              <picture>
                <source srcset="{{ $large.RelPermalink }} 1600w, {{ $medium.RelPermalink }} 1024w, {{ $small.RelPermalink }} 640w" sizes="(min-width: 992px) 45vw, 100vw" />
                <img src="{{ $medium.RelPermalink }}" alt="{{ with .Params.image.caption }}{{ . }}{{ else }}{{ .Title }}{{ end }}" loading="lazy" />
              </picture>
            </a>
          </div>
        {{ end }}

        <div class="media-body">
          <h2 class="section-subheading article-title mb-0 mt-0"><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>
          {{ with .Params.summary }}
            <p class="article-style">{{ . }}</p>
          {{ end }}
          <div class="stream-meta article-metadata">
            <div class="article-metadata">
              {{/* Authors (if present) */}}
              {{ with .Params.authors }}
                {{ $auths := delimit . ", " }}
                <div class="article-authors">{{ $auths }}</div>
              {{ end }}

              {{/* Per-page last-modified: prefer GitInfo.AuthorDate when available, fallback to .Lastmod */}}
              {{ $fmt := "Jan 2, 2006" }}
              {{ $.Scratch.Set "lm" .Lastmod }}
              {{ with .GitInfo }}{{ $.Scratch.Set "lm" .AuthorDate }}{{ end }}
              {{ $lm := $.Scratch.Get "lm" }}
              {{ if $lm }}
                <div class="article-date">Last updated: {{ $lm.Format $fmt }}</div>
              {{ end }}
            </div>
          </div>
        </div>

      </article>
    {{ end }}
  </div>
</section>
{{ end }}
