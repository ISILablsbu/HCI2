{{ define "main" }}
<div class="universal-wrapper">

  <h1>{{ .Title }}</h1>

  <div class="research-list">
    {{ range .Pages.ByWeight.ByTitle }}

      {{/* --- Build responsive thumbnails from page-bundle featured* --- */}}
      {{ $thumbSm := "" }}
      {{ $thumbLg := "" }}

      {{ with .Resources }}
        {{ with .GetMatch "featured*" }}
          {{ $sm := .Fill "720x405 q85" }}
          {{ $lg := .Fill "1440x810 q85" }}
          {{ $thumbSm = $sm.RelPermalink }}
          {{ $thumbLg = $lg.RelPermalink }}
        {{ end }}
      {{ end }}

      {{/* --- Fallback to front matter image.main (no processing) --- */}}
      {{ $fallback := "" }}
      {{ if not $thumbLg }}
        {{ with .Params.image }}{{ with .main }}{{ $fallback = (. | relURL) }}{{ end }}{{ end }}
      {{ end }}

      <a class="research-row" href="{{ .RelPermalink }}" aria-label="{{ .Title }}">

        <div class="research-row-thumb">
          {{ if and $thumbSm $thumbLg }}
            <img
              src="{{ $thumbLg }}"
              srcset="{{ $thumbSm }} 720w, {{ $thumbLg }} 1440w"
              sizes="(max-width: 992px) 100vw, 360px"
              alt="{{ .Title }}"
              loading="lazy">
          {{ else if $fallback }}
            <img
              src="{{ $fallback }}"
              alt="{{ .Title }}"
              loading="lazy">
          {{ else }}
            <div class="research-row-thumb-placeholder" aria-hidden="true"></div>
          {{ end }}
        </div>

        <div class="research-row-body">
          <div class="research-row-title">{{ .Title }}</div>

          {{ with .Params.tags }}
            <div class="research-row-tags">
              {{ range . }}
                <span class="research-row-tag">{{ . }}</span>
              {{ end }}
            </div>
          {{ end }}

          {{ with .Params.summary }}
            <div class="research-row-summary">{{ . }}</div>
          {{ end }}
        </div>

      </a>

    {{ end }}
  </div>

</div>
{{ end }}
